# Retrieve all Users PowerShell History

try {
    $Users = Get-ChildItem -Path "C:\Users\*\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadline\ConsoleHost_history.txt" | Select-Object -ExpandProperty FullName

    if ($Users) {
        foreach ($UserHistoryFile in $Users) {
            Write-Host "`n----User Pwsh History Path $UserHistoryFile---`n" -ForegroundColor Magenta
            Get-Content $UserHistoryFile
        }
    } else {
        $ErrorMessage = "No PSReadline history files found. If the script doesn't work, please visit 'C:\Users\*\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadline\ConsoleHost_history.txt' and 'c:\windows\system32\config\systemprofile\appdata\roaming\microsoft\windows\powershell\psreadline\consolehost_history.txt' by yourself."
        Write-Host $ErrorMessage -ForegroundColor Yellow
    }
} catch {
    Write-Host "An error occurred: $_" -ForegroundColor Red
}
