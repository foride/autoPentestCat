# Retrieve TCP connections information, including process details and command-line arguments

try {
    # Retrieve TCP connection information
    $TCPConnections = Get-NetTCPConnection |
                      Select-Object LocalAddress, LocalPort, RemoteAddress, RemotePort, State, 
                                    @{Name="Process"; Expression={(Get-Process -Id $_.OwningProcess).ProcessName}}, 
                                    @{Name="CmdLine"; Expression={(Get-WmiObject Win32_Process -Filter "ProcessId = $($_.OwningProcess)").CommandLine}} |
                      Sort-Object RemoteAddress -Descending |
                      Format-Table -Wrap -AutoSize

    # Display the formatted TCP connection information
    Write-Output $TCPConnections
} catch {
    Write-Host "An error occurred: $_" -ForegroundColor Red
}
